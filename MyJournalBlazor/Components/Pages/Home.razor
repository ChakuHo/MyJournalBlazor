@page "/"
@using MyJournalBlazor.Models
@using MyJournalBlazor.Services
@inject DatabaseService DbService

<div class="fade-in">
    <h1 class="mb-4">New Entry</h1>

    <div class="journal-card">

        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label">Date</label>
                <input type="date" class="form-control" @bind="currentEntry.Date" />
            </div>

            <div class="col-md-6 mb-3">
                <label class="form-label">Mood</label>
                <select class="form-control" @bind="currentEntry.Mood">
                    <option>Positive</option>
                    <option>Neutral</option>
                    <option>Negative</option>
                </select>
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Title</label>
            <input type="text" class="form-control" placeholder="Summarize your day..." @bind="currentEntry.Title" />
        </div>

        <div class="mb-3">
            <label class="form-label">Content</label>
            <textarea class="form-control" rows="6" placeholder="What happened today?" @bind="currentEntry.Content"></textarea>
        </div>

        <button class="btn btn-primary w-100" @onclick="SaveEntry">Save Entry</button>
    </div>
</div>

@code {
    private JournalEntry currentEntry = new JournalEntry();

    private async Task SaveEntry()
    {
        // 1. VALIDATION CHECK
        if (string.IsNullOrWhiteSpace(currentEntry.Title))
        {
            await App.Current.MainPage.DisplayAlert("Validation Error", "Please write a Title for your entry.", "OK");
            return;
        }

        if (string.IsNullOrWhiteSpace(currentEntry.Content))
        {
            await App.Current.MainPage.DisplayAlert("Validation Error", "You cannot save an empty journal! Write something.", "OK");
            return;
        }

        // 2. SAVE
        currentEntry.CreatedAt = DateTime.Now;
        await DbService.SaveEntryAsync(currentEntry);

        // 3. RESET FORM
        currentEntry = new JournalEntry();

        // 4. SUCCESS MESSAGE
        await App.Current.MainPage.DisplayAlert("Success", "Journal Saved Successfully!", "OK");
    }
}